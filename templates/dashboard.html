<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Monitoring Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>System Monitoring</h1>

    <!-- Container for the charts -->
    <div style="width: 80%; margin: auto;">
        <canvas id="cpuChart"></canvas>
        <canvas id="ramChart"></canvas>
        <canvas id="diskChart"></canvas>
        <canvas id="netSentChart"></canvas>
        <canvas id="netRecvChart"></canvas>
        <canvas id="temperatureChart"></canvas>
    </div>

    <script>
        let timestamps = [];
        let cpuUsage = [];
        let ram = [];
        let disk = [];
        let netSent = [];
        let netRecv = [];
        let temperature = [];

        const cpuChart = new Chart(document.getElementById('cpuChart'), {
            type: 'line',
            data: {
                labels: timestamps,
                datasets: [{
                    label: 'CPU Usage (%)',
                    data: cpuUsage,
                    borderColor: 'rgba(255, 99, 132, 1)',
                    fill: false,
                }]
            }
        });

        const ramChart = new Chart(document.getElementById('ramChart'), {
            type: 'line',
            data: {
                labels: timestamps,
                datasets: [{
                    label: 'RAM Usage (%)',
                    data: ram,
                    borderColor: 'rgba(54, 162, 235, 1)',
                    fill: false,
                }]
            }
        });

        const diskChart = new Chart(document.getElementById('diskChart'), {
            type: 'line',
            data: {
                labels: timestamps,
                datasets: [{
                    label: 'Disk Usage (%)',
                    data: disk,
                    borderColor: 'rgba(75, 192, 192, 1)',
                    fill: false,
                }]
            }
        });

        const netSentChart = new Chart(document.getElementById('netSentChart'), {
            type: 'line',
            data: {
                labels: timestamps,
                datasets: [{
                    label: 'Network Sent (MB)',
                    data: netSent,
                    borderColor: 'rgba(153, 102, 255, 1)',
                    fill: false,
                }]
            }
        });

        const netRecvChart = new Chart(document.getElementById('netRecvChart'), {
            type: 'line',
            data: {
                labels: timestamps,
                datasets: [{
                    label: 'Network Received (MB)',
                    data: netRecv,
                    borderColor: 'rgba(255, 159, 64, 1)',
                    fill: false,
                }]
            }
        });

        const temperatureChart = new Chart(document.getElementById('temperatureChart'), {
            type: 'line',
            data: {
                labels: timestamps,
                datasets: [{
                    label: 'Temperature (Â°C)',
                    data: temperature,
                    borderColor: 'rgba(255, 205, 86, 1)',
                    fill: false,
                }]
            }
        });

        function fetchData() {
            $.get("/api/data", function(data) {
                if (data.error) {
                    console.error(data.error);
                    return;
                }

                // Update global arrays with the latest data
                timestamps = data.timestamps;
                cpuUsage = data.cpu_usage;
                ram = data.ram;
                disk = data.disk;
                netSent = data.net_sent;
                netRecv = data.net_recv;
                temperature = data.temperature;

                // Update the chart data
                cpuChart.data.labels = timestamps;
                cpuChart.data.datasets[0].data = cpuUsage;
                cpuChart.update();

                ramChart.data.labels = timestamps;
                ramChart.data.datasets[0].data = ram;
                ramChart.update();

                diskChart.data.labels = timestamps;
                diskChart.data.datasets[0].data = disk;
                diskChart.update();

                netSentChart.data.labels = timestamps;
                netSentChart.data.datasets[0].data = netSent;
                netSentChart.update();

                netRecvChart.data.labels = timestamps;
                netRecvChart.data.datasets[0].data = netRecv;
                netRecvChart.update();

                temperatureChart.data.labels = timestamps;
                temperatureChart.data.datasets[0].data = temperature;
                temperatureChart.update();
            }).fail(function() {
                console.error("Error fetching data");
            });
        }

        // Fetch data initially and then every minute
        fetchData();
        setInterval(fetchData, 60000);  // Fetch new data every minute
    </script>
</body>
</html>
